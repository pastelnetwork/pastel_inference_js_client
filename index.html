<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pastel Inference Client UI</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@sira-ui/tailwind/dist/css/styles.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .ground-glass {
        background-color: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(10px);
      }
      body {
        font-family: Montserrat, sans-serif;
      }
    </style>
  </head>
  <body class="flex flex-col gap-6 px-20 transition-all duration-300 bg-bw-50">
    <div
      class="flex gap-6 items-center sticky top-0 p-4 bg-bw-50 z-10 ground-glass shadow-md"
      id="title"
    >
      <h1 class="text-4xl font-bold text-info-800">Pastel Inference Client</h1>
      <input
        id="theme-toggle"
        class="switch success lg"
        data-content="☀"
        type="checkbox"
        onchange="toggleDarkMode()"
      />
    </div>
    <div
      class="grid grid-cols-5 gap-4 p-4 has-border rounded-xl bg-white shadow-md"
    >
      <h2 class="text-2xl col-span-full text-info-800">User Information</h2>
      <div class="col-span-full">
        <button
          id="changePastelIDButton"
          class="btn solid success"
          onclick="togglePastelIDDropdown()"
        >
          Switch to a Different PastelID
        </button>
        <div id="pastelIDDropdownContainer" class="mt-4 hidden">
          <label class="block text-bw-700 font-bold mb-2">
            Select Existing PastelID to Use:
          </label>
          <select id="pastelIDDropdown" class="select w-full">
            <!-- Options will be dynamically populated -->
          </select>
        </div>
        <div class="mt-4">
          <label class="block text-bw-700 font-bold mb-2">
            Your Currently Selected PastelID:
          </label>
          <span id="userPastelID" class="text-bw-700">Loading...</span>
        </div>
        <div class="mt-4">
          <label class="block text-bw-700 font-bold mb-2">
            Wallet Balance (PSL):
          </label>
          <span id="walletBalance" class="text-bw-700">Loading...</span>
        </div>
        <button id="createPastelIDButton" class="btn solid success mt-4 hidden">
          Create a PastelID so you can make inference requests? (Costs 1,000
          PSL)
        </button>
      </div>
    </div>

    <div
      class="grid grid-cols-1 gap-4 p-4 has-border rounded-xl bg-white shadow-md"
    >
      <h2 class="text-2xl text-success-800">Create New Credit Pack Ticket</h2>
      <form id="createTicketForm" class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-bw-700 font-bold mb-2" for="numCredits">
            Number of Credits
          </label>
          <input
            class="input w-full"
            id="numCredits"
            type="number"
            placeholder="Enter number of credits"
            value="1500"
          />
        </div>
        <div>
          <label
            class="block text-bw-700 font-bold mb-2"
            for="creditUsageTrackingPSLAddress"
          >
            Credit Usage Tracking PSL Address
          </label>
          <input
            class="input w-full"
            id="creditUsageTrackingPSLAddress"
            type="text"
            placeholder="Enter credit usage tracking PSL address"
            value="tPsj2K9tnWQWNUmunqJYvKQsKqXrewJFrFK"
          />
        </div>
        <div>
          <label class="block text-bw-700 font-bold mb-2" for="maxTotalPrice">
            Maximum Total Price (PSL)
          </label>
          <input
            class="input w-full"
            id="maxTotalPrice"
            type="number"
            step="0.01"
            placeholder="Enter maximum total price"
            value="150000"
          />
        </div>
        <div>
          <label
            class="block text-bw-700 font-bold mb-2"
            for="maxPerCreditPrice"
          >
            Maximum Per Credit Price (PSL)
          </label>
          <input
            class="input w-full"
            id="maxPerCreditPrice"
            type="number"
            step="0.01"
            placeholder="Enter maximum per credit price"
            value="0.1"
          />
        </div>
        <div class="col-span-full flex justify-between">
          <button class="btn solid success" type="submit">Create Ticket</button>
          <button class="btn outline bw" type="button" id="clearTicketForm">
            Clear Demo Input
          </button>
        </div>
      </form>
    </div>

    <div
      class="grid grid-cols-1 gap-4 p-4 has-border rounded-xl bg-white shadow-md"
    >
      <h2 class="text-2xl text-warn-800">Select Existing Credit Pack Ticket</h2>
      <div class="relative text-bw-700">
        <select id="creditPackTicketSelect" class="select w-full">
          <option value="">Select a credit pack ticket</option>
          <option value="ticket1" selected>
            Ticket 1 - 1500 credits - 150000 PSL
          </option>
          <option value="ticket2">Ticket 2 - 1000 credits - 100000 PSL</option>
          <option value="ticket3">Ticket 3 - 500 credits - 50000 PSL</option>
        </select>
      </div>
    </div>

    <div
      class="grid grid-cols-1 gap-4 p-4 has-border rounded-xl bg-white shadow-md"
    >
      <h2 class="text-2xl text-danger-800">
        Check Existing Credit Pack Ticket Info
      </h2>
      <form id="checkCreditPackForm" class="grid grid-cols-1 gap-4">
        <div>
          <label class="block text-bw-700 font-bold mb-2" for="creditPackTxid">
            Credit Pack Ticket TXID
          </label>
          <input
            class="input w-full"
            id="creditPackTxid"
            type="text"
            placeholder="Enter credit pack ticket TXID"
            value="e8954607c3e64a00e81b216516f403b687698c59ca31ef3faf92793a113fcd5e"
          />
        </div>
        <div class="flex justify-between">
          <button class="btn solid success" type="submit">
            Check Credit Pack
          </button>
          <button
            class="btn outline bw"
            type="button"
            id="clearCheckCreditPackForm"
          >
            Clear Demo Input
          </button>
        </div>
      </form>
    </div>

    <div
      class="grid grid-cols-1 gap-4 p-4 has-border rounded-xl bg-white shadow-md"
    >
      <h2 class="text-2xl text-info-800">Create New Inference Request</h2>
      <form id="inferenceRequestForm" class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-bw-700 font-bold mb-2" for="inferenceType">
            Inference Type
          </label>
          <div class="relative text-bw-700">
            <select id="inferenceType" class="select w-full">
              <option value="">Select an inference type</option>
              <option value="text_completion" selected>Text Completion</option>
              <option value="image_generation">Image Generation</option>
            </select>
          </div>
        </div>
        <div>
          <label class="block text-bw-700 font-bold mb-2" for="model">
            Model/Service
          </label>
          <div class="relative text-bw-700">
            <select id="model" class="select w-full">
              <option value="">Select a model/service</option>
              <option value="claude3-opus" selected>Claude3-Opus</option>
              <option value="gpt-3">GPT-3</option>
            </select>
          </div>
        </div>
        <div id="textCompletionSettings" class="col-span-full">
          <div class="mb-4">
            <label class="block text-bw-700 font-bold mb-2" for="prompt">
              Prompt
            </label>
            <textarea
              class="input w-full"
              id="prompt"
              rows="5"
              placeholder="Enter your prompt"
            >
How do you measure the speed of an earthquake?</textarea
            >
          </div>
          <div class="mb-4">
            <label class="block text-bw-700 font-bold mb-2" for="maxTokens">
              Max Tokens
            </label>
            <input
              class="input w-full"
              id="maxTokens"
              type="number"
              placeholder="Enter maximum tokens"
              value="2000"
            />
          </div>
          <div>
            <label
              class="block text-bw-700 font-bold mb-2"
              for="numCompletions"
            >
              Number of Completions
            </label>
            <input
              class="input w-full"
              id="numCompletions"
              type="number"
              placeholder="Enter number of completions"
              value="1"
            />
          </div>
        </div>
        <div
          id="imageGenerationSettings"
          class="col-span-full"
          style="display: none"
        >
          <div class="mb-4">
            <label class="block text-bw-700 font-bold mb-2" for="imagePrompt">
              Image Prompt
            </label>
            <textarea
              class="input w-full"
              id="imagePrompt"
              rows="5"
              placeholder="Enter your image prompt"
            >
A picture of a clown holding a sign that says PASTEL</textarea
            >
          </div>
          <div class="mb-4">
            <label class="block text-bw-700 font-bold mb-2" for="stylePreset">
              Style Preset
            </label>
            <div class="relative text-bw-700">
              <select id="stylePreset" class="select w-full">
                <option value="">Select a style preset</option>
                <option value="photographic" selected>Photographic</option>
                <option value="digital-art">Digital Art</option>
                <option value="comic-book">Comic Book</option>
                <!-- Add more style preset options as needed -->
              </select>
            </div>
          </div>
          <div class="mb-4">
            <label class="block text-bw-700 font-bold mb-2" for="outputFormat">
              Output Format
            </label>
            <div class="relative text-bw-700">
              <select id="outputFormat" class="select w-full">
                <option value="">Select an output format</option>
                <option value="png" selected>PNG</option>
                <option value="jpeg">JPEG</option>
                <option value="webp">WebP</option>
              </select>
            </div>
          </div>
          <div>
            <label class="block text-bw-700 font-bold mb-2" for="aspectRatio">
              Aspect Ratio
            </label>
            <div class="relative text-bw-700">
              <select id="aspectRatio" class="select w-full">
                <option value="">Select an aspect ratio</option>
                <option value="16:9" selected>16:9</option>
                <option value="1:1">1:1</option>
                <option value="4:5">4:5</option>
                <!-- Add more aspect ratio options as needed -->
              </select>
            </div>
          </div>
        </div>
        <div class="mb-4">
          <label class="block text-bw-700 font-bold mb-2" for="maxCost">
            Maximum Cost (Credits)
          </label>
          <input
            class="input w-full"
            id="maxCost"
            type="number"
            step="0.01"
            placeholder="Enter maximum cost"
            value="200"
          />
        </div>
        <div class="col-span-full flex justify-between">
          <button class="btn solid success" type="submit">
            Create Inference Request
          </button>
          <button class="btn outline bw" type="button" id="clearInferenceForm">
            Clear Demo Input
          </button>
        </div>
      </form>
    </div>

    <div
      class="grid grid-cols-1 lg:grid-cols-2 gap-8 p-4 has-border rounded-xl bg-white shadow-md"
    >
      <div>
        <h2 class="text-2xl mb-4 text-info-800">Send Message</h2>
        <form id="sendMessageForm" class="grid grid-cols-1 gap-4">
          <div>
            <label class="block text-bw-700 font-bold mb-2" for="toPastelID">
              Recipient Pastel ID
            </label>
            <input
              class="input w-full"
              id="toPastelID"
              type="text"
              placeholder="Enter recipient Pastel ID"
              value="jXXiVgtFzLto4eYziePHjjb1hj3c6eXdABej5ndnQ62B8ouv1GYveJaD5QUMfainQM3b4MTieQuzFEmJexw8Cr"
            />
          </div>
          <div>
            <label class="block text-bw-700 font-bold mb-2" for="messageBody">
              Message Body
            </label>
            <textarea
              class="input w-full"
              id="messageBody"
              rows="5"
              placeholder="Enter your message"
            >
Hello, this is a brand 🍉 NEW test message from a regular user!</textarea
            >
            >
          </div>
          <div class="flex justify-between">
            <button class="btn solid success" type="submit">
              Send Message
            </button>
            <button class="btn outline bw" type="button" id="clearMessageForm">
              Clear Demo Input
            </button>
          </div>
        </form>
      </div>
      <div>
        <h2 class="text-2xl mb-4">Received Messages</h2>
        <div id="receivedMessages" class="bg-bw-50 p-4 rounded-xl">
          <!-- Received messages will be dynamically populated here -->
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 gap-4 p-4 has-border rounded-xl">
      <h2 class="text-2xl">Manage Wallet</h2>
      <div class="mb-4">
        <label class="block text-bw-700 font-bold mb-2" for="importPrivKey">
          Import Private Key
          <span
            class="tooltip"
            data-tooltip="Import a private key into your wallet."
            >&#9432;</span
          >
        </label>
        <input
          id="importPrivKey"
          class="input w-full"
          type="text"
          placeholder="Enter private key"
        />
        <button id="importPrivKeyButton" class="btn solid success mt-2">
          Import
        </button>
      </div>
      <div class="mb-4">
        <label class="block text-bw-700 font-bold mb-2" for="importWallet">
          Import Wallet
          <span
            class="tooltip"
            data-tooltip="Import a wallet file into your wallet."
            >&#9432;</span
          >
        </label>
        <input
          id="importWallet"
          class="input w-full"
          type="file"
          accept=".dat"
        />
        <button id="importWalletButton" class="btn solid success mt-2">
          Import
        </button>
      </div>
      <div class="mb-4">
        <button id="listAddressAmountsButton" class="btn solid success">
          List Address Amounts
          <span
            class="tooltip"
            data-tooltip="List the amounts associated with each address in your wallet."
            >&#9432;</span
          >
        </button>
      </div>
      <div>
        <button id="getWalletInfoButton" class="btn solid success">
          Get Wallet Info
          <span
            class="tooltip"
            data-tooltip="Retrieve information about your wallet."
            >&#9432;</span
          >
        </button>
      </div>
    </div>
    <button onclick="toggleTerminal()" class="btn solid success">
      Toggle Terminal
    </button>
    <div id="terminal"></div>

    <div class="bg-bw-800 text-bw-50 py-6">
      <div class="container mx-auto px-4">
        <p class="text-center">
          &copy; 2023 Pastel Inference Client UI. All rights reserved.
        </p>
      </div>
    </div>

    <script>
      const MESSAGING_TIMEOUT_IN_SECONDS = 60;

      function togglePastelIDDropdown() {
        const dropdown = document.getElementById("pastelIDDropdown");
        dropdown.classList.toggle("hidden");
      }

      function updatePastelIDSelection() {
        const selectedID = document.getElementById("pastelIDDropdown").value;
        document.getElementById("userPastelID").textContent = selectedID;
        togglePastelIDDropdown(); // Hide dropdown after selection
      }

      async function checkCreditPackTicketInfo() {
        try {
          const response = await axios.get("/get-credit-pack-ticket-info");
          const { requestResponse, requestConfirmation } = response.data;
          document.getElementById("requestResponse").textContent =
            requestResponse;
          document.getElementById("requestConfirmation").textContent =
            requestConfirmation;
        } catch (error) {
          console.error("Error checking credit pack ticket info:", error);
        }
      } // Function to check credit pack ticket info

      // Handle create ticket form submission
      const createTicketForm = document.getElementById("createTicketForm");
      createTicketForm.addEventListener("submit", async (event) => {
        event.preventDefault();
        const numCredits = parseInt(
          document.getElementById("numCredits").value
        );
        const creditUsageTrackingPSLAddress = document.getElementById(
          "creditUsageTrackingPSLAddress"
        ).value;
        const maxTotalPrice = parseFloat(
          document.getElementById("maxTotalPrice").value
        );
        const maxPerCreditPrice = parseFloat(
          document.getElementById("maxPerCreditPrice").value
        );
        await createNewCreditPackTicket(
          numCredits,
          creditUsageTrackingPSLAddress,
          maxTotalPrice,
          maxPerCreditPrice
        );
      });

      // Handle check credit pack form submission
      const checkCreditPackForm = document.getElementById(
        "checkCreditPackForm"
      );
      checkCreditPackForm.addEventListener("submit", async (event) => {
        event.preventDefault();
        const creditPackTxid = document.getElementById("creditPackTxid").value;
        await checkCreditPackTicketInfo(creditPackTxid);
      });

      // Handle inference request stuff:
      let modelMenu = null;

      async function fetchModelMenu() {
        try {
          const response = await axios.get("/get-inference-model-menu");
          modelMenu = response.data.modelMenu;
          console.log("Model Menu:", modelMenu); // Debugging line, consider removing for production
          populateModelDropdown();
        } catch (error) {
          console.error("Error fetching model menu:", error);
          displayError("Failed to load model menu. Please try again later.");
        }
      }

      function populateModelDropdown() {
        const selectedInferenceType = inferenceTypeSelect.value;
        const modelSelect = document.getElementById("model");
        modelSelect.innerHTML =
          '<option value="">Select a model/service</option>';

        if (modelMenu) {
          const filteredModels = modelMenu.models.filter(
            (model) =>
              model.supported_inference_type_strings &&
              model.supported_inference_type_strings.includes(
                selectedInferenceType
              )
          );

          filteredModels.forEach((model) => {
            const option = document.createElement("option");
            option.value = model.model_name;
            option.textContent = model.model_name;
            modelSelect.appendChild(option);
          });
        }
      }

      function displayError(message) {
        // Implement user-friendly error handling/display mechanism
        alert(message); // Simplistic example, consider more sophisticated modal or notification systems
      }

      // Load inference request settings from localStorage
      function loadInferenceRequestSettings() {
        const selectedInferenceType = inferenceTypeSelect.value;
        const storedSettings = localStorage.getItem(
          `inferenceRequestSettings_${selectedInferenceType}`
        );
        if (storedSettings) {
          const settings = JSON.parse(storedSettings);
          document.getElementById("model").value = settings.model || "";
          document.getElementById("prompt").value = settings.prompt || "";
          document.getElementById("maxTokens").value = settings.maxTokens || "";
          document.getElementById("numCompletions").value =
            settings.numCompletions || "";
          document.getElementById("maxCost").value = settings.maxCost || "";
          document.getElementById("imagePrompt").value =
            settings.imagePrompt || "";
          document.getElementById("stylePreset").value =
            settings.stylePreset || "";
          document.getElementById("outputFormat").value =
            settings.outputFormat || "";
          document.getElementById("aspectRatio").value =
            settings.aspectRatio || "";
        }
      }

      // Save inference request settings to localStorage
      function saveInferenceRequestSettings() {
        const selectedInferenceType = inferenceTypeSelect.value;
        const settings = {
          model: document.getElementById("model").value,
          prompt: document.getElementById("prompt").value,
          maxTokens: document.getElementById("maxTokens").value,
          numCompletions: document.getElementById("numCompletions").value,
          maxCost: document.getElementById("maxCost").value,
          imagePrompt: document.getElementById("imagePrompt").value,
          stylePreset: document.getElementById("stylePreset").value,
          outputFormat: document.getElementById("outputFormat").value,
          aspectRatio: document.getElementById("aspectRatio").value,
        };
        localStorage.setItem(
          `inferenceRequestSettings_${selectedInferenceType}`,
          JSON.stringify(settings)
        );
      }

      // Fetch the model menu when the page loads
      fetchModelMenu();

      // Handle inference type change
      const inferenceTypeSelect = document.getElementById("inferenceType");
      const textCompletionSettings = document.getElementById(
        "textCompletionSettings"
      );
      const imageGenerationSettings = document.getElementById(
        "imageGenerationSettings"
      );

      inferenceTypeSelect.addEventListener("change", () => {
        const selectedInferenceType = inferenceTypeSelect.value;
        if (selectedInferenceType === "text_completion") {
          textCompletionSettings.style.display = "block";
          imageGenerationSettings.style.display = "none";
        } else if (selectedInferenceType === "image_generation") {
          textCompletionSettings.style.display = "none";
          imageGenerationSettings.style.display = "block";
        }
        populateModelDropdown();
        loadInferenceRequestSettings();
      });

      // Handle inference request form submission
      const inferenceRequestForm = document.getElementById(
        "inferenceRequestForm"
      );
      inferenceRequestForm.addEventListener("submit", async (event) => {
        event.preventDefault();
        saveInferenceRequestSettings();
        const selectedCreditPackTicketId = document.getElementById(
          "creditPackTicketSelect"
        ).value;
        const selectedInferenceType =
          document.getElementById("inferenceType").value;
        const selectedModel = document.getElementById("model").value;
        const prompt = document.getElementById("prompt").value;
        const maxTokens = parseInt(document.getElementById("maxTokens").value);
        const numCompletions = parseInt(
          document.getElementById("numCompletions").value
        );
        const maxCost = parseFloat(document.getElementById("maxCost").value);
        await createNewInferenceRequest(
          selectedCreditPackTicketId,
          selectedInferenceType,
          selectedModel,
          prompt,
          maxTokens,
          numCompletions,
          maxCost
        );
      });

      // Handle clear ticket form button click
      const clearTicketFormButton = document.getElementById("clearTicketForm");
      clearTicketFormButton.addEventListener("click", () => {
        document.getElementById("numCredits").value = "";
        document.getElementById("creditUsageTrackingPSLAddress").value = "";
        document.getElementById("maxTotalPrice").value = "";
        document.getElementById("maxPerCreditPrice").value = "";
      });

      // Handle clear inference form button click
      const clearInferenceFormButton =
        document.getElementById("clearInferenceForm");
      clearInferenceFormButton.addEventListener("click", () => {
        document.getElementById("creditPackTicketSelect").selectedIndex = 0;
        document.getElementById("inferenceType").selectedIndex = 0;
        document.getElementById("model").selectedIndex = 0;
        document.getElementById("prompt").value = "";
        document.getElementById("maxTokens").value = "";
        document.getElementById("numCompletions").value = "";
        document.getElementById("maxCost").value = "";
      });

      // Handle send message form submission
      const sendMessageForm = document.getElementById("sendMessageForm");
      sendMessageForm.addEventListener("submit", async (event) => {
        event.preventDefault();
        const toPastelID = document.getElementById("toPastelID").value;
        const messageBody = document.getElementById("messageBody").value;
        await sendMessage(toPastelID, messageBody);
        await fetchReceivedMessages();
      });

      // Handle clear message form button click
      const clearMessageFormButton =
        document.getElementById("clearMessageForm");
      clearMessageFormButton.addEventListener("click", () => {
        document.getElementById("toPastelID").value = "";
        document.getElementById("messageBody").value = "";
      });
      // Function to fetch and display received messages
      async function fetchReceivedMessages() {
        try {
          const userPastelID =
            document.getElementById("pastelIDDropdown").value;

          const response = await axios.get("/get-best-supernode-url", {
            params: { userPastelID },
          });
          const supernodeURL = response.data.supernodeURL;

          const messagesResponse = await axios.get("/get-received-messages", {
            timeout: MESSAGING_TIMEOUT_IN_SECONDS * 1000,
          });
          const messageDict = messagesResponse.data.messageDict;

          const receivedMessagesContainer =
            document.getElementById("receivedMessages");
          receivedMessagesContainer.innerHTML = ""; // Clear previous messages

          for (const pastelId in messageDict) {
            const messages = messageDict[pastelId];
            messages.forEach((message) => {
              const messageElement = document.createElement("div");
              messageElement.classList.add(
                "mb-4",
                "border",
                "border-gray-300",
                "rounded-lg",
                "p-4"
              );

              const fromPastelIDElement = document.createElement("p");
              fromPastelIDElement.classList.add(
                "text-sm",
                "font-medium",
                "text-gray-600",
                "mb-2"
              );
              fromPastelIDElement.textContent = `From: ${pastelId}`;

              const messageBodyElement = document.createElement("p");
              messageBodyElement.classList.add(
                "text-base",
                "text-gray-800",
                "mb-2"
              );
              messageBodyElement.textContent = message.message_body;

              const timestampElement = document.createElement("p");
              timestampElement.classList.add("text-xs", "text-gray-500");
              timestampElement.textContent = new Date(
                message.timestamp
              ).toLocaleString();

              messageElement.appendChild(fromPastelIDElement);
              messageElement.appendChild(messageBodyElement);
              messageElement.appendChild(timestampElement);

              receivedMessagesContainer.appendChild(messageElement);
            });
          }
        } catch (error) {
          console.error("Error retrieving received messages:", error);
          const receivedMessagesContainer =
            document.getElementById("receivedMessages");
          receivedMessagesContainer.innerHTML =
            "Failed to retrieve received messages. Please try again later.";
        }
      }

      // Fetch received messages when the page loads
      window.addEventListener("DOMContentLoaded", fetchReceivedMessages);

      // Handle clear check credit pack form button click
      const clearCheckCreditPackFormButton = document.getElementById(
        "clearCheckCreditPackForm"
      );
      clearCheckCreditPackFormButton.addEventListener("click", () => {
        document.getElementById("creditPackTxid").value = "";
      });

      // Check user's PastelID and wallet balance on page load
      window.addEventListener("DOMContentLoaded", async () => {
        const pastelIDElement = document.getElementById("userPastelID");
        const pastelIDDropdown = document.getElementById("pastelIDDropdown");
        const pastelIDDropdownContainer = document.getElementById(
          "pastelIDDropdownContainer"
        );
        const walletBalanceElement = document.getElementById("walletBalance");
        const createPastelIDButton = document.getElementById(
          "createPastelIDButton"
        );
        const changePastelIDButton = document.getElementById(
          "changePastelIDButton"
        );

        try {
          const response = await axios.get("/list-pastel-id-tickets", {
            params: { filter: "mine" },
          });
          const pastelIDTickets = response.data.result;

          if (pastelIDTickets.length > 0) {
            pastelIDTickets.forEach((ticket, index) => {
              const option = document.createElement("option");
              option.value = ticket.ticket.pastelID;
              option.textContent = ticket.ticket.pastelID;
              pastelIDDropdown.appendChild(option);
              if (index === 0) {
                pastelIDElement.textContent = ticket.ticket.pastelID; // Display the first PastelID by default
              }
            });
            if (pastelIDTickets.length > 1) {
              changePastelIDButton.classList.remove("hidden");
              pastelIDDropdownContainer.classList.remove("hidden");
            }
          } else {
            pastelIDElement.textContent = "No PastelID found";
            createPastelIDButton.style.display = "block"; // Show create button if no IDs
          }
        } catch (error) {
          console.error("Error retrieving Pastel ID tickets:", error);
          pastelIDElement.textContent = "Failed to load PastelIDs";
        }

        try {
          const walletInfoResponse = await axios.get("/get-wallet-info");
          const walletInfo = walletInfoResponse.data.result;
          walletBalanceElement.textContent = `${walletInfo.balance} PSL`;
        } catch (walletError) {
          console.error("Error retrieving wallet info:", walletError);
          walletBalanceElement.textContent = "Failed to load balance";
        }
      });

      // Handle create PastelID button click
      document
        .getElementById("createPastelIDButton")
        .addEventListener("click", async () => {
          try {
            await axios.post("/check-for-pastel-id", { autoRegister: true });
            location.reload(); // Refresh the page to update the UI
          } catch (error) {
            console.error("Error creating PastelID:", error);
          }
        });

      // Handle import private key form submission
      document
        .getElementById("importPrivKeyButton")
        .addEventListener("click", async () => {
          const privKey = document.getElementById("importPrivKey").value;
          try {
            await axios.post("/import-priv-key", { zcashPrivKey: privKey });
            alert("Private key imported successfully!");
          } catch (error) {
            console.error("Error importing private key:", error);
          }
        });

      // Handle import wallet form submission
      document
        .getElementById("importWalletButton")
        .addEventListener("click", async () => {
          const walletFile = document.getElementById("importWallet").files[0];
          const formData = new FormData();
          formData.append("walletFile", walletFile);
          try {
            await axios.post("/import-wallet", formData);
            alert("Wallet imported successfully!");
          } catch (error) {
            console.error("Error importing wallet:", error);
          }
        });

      // Handle list address amounts button click
      document
        .getElementById("listAddressAmountsButton")
        .addEventListener("click", async () => {
          try {
            const response = await axios.get("/list-address-amounts");
            const addressAmounts = response.data.result;
            console.log("Address amounts:", addressAmounts);
            // Display the address amounts in the UI as needed
          } catch (error) {
            console.error("Error retrieving address amounts:", error);
          }
        });

      // Handle get wallet info button click
      document
        .getElementById("getWalletInfoButton")
        .addEventListener("click", async () => {
          try {
            const response = await axios.get("/get-wallet-info");
            const walletInfo = response.data.result;
            console.log("Wallet info:", walletInfo);
            // Display the wallet info in the UI as needed
          } catch (error) {
            console.error("Error retrieving wallet info:", error);
          }
        });

      // Create a terminal
      const term = new Terminal();
      term.open(document.getElementById("terminal"));

      // Connect to the WebSocket
      const socket = new WebSocket("ws://localhost:3101");
      socket.onmessage = (event) => {
        const logMessage = JSON.parse(event.data);
        term.writeln(
          `[${logMessage.timestamp}] [${logMessage.level}] ${logMessage.message}`
        );
      };

      // Function to toggle the terminal visibility
      function toggleTerminal() {
        const terminal = document.getElementById("terminal");
        if (terminal.style.display === "none") {
          terminal.style.display = "block";
        } else {
          terminal.style.display = "none";
        }
      }

      tailwind.config = {
        theme: {
          extend: {},
        },
      };

      var storedTheme =
        localStorage.getItem("theme") ||
        (window.matchMedia("(prefers-color-scheme: dark)").matches
          ? "dark"
          : "light");
      if (storedTheme)
        document.documentElement.setAttribute("data-theme", storedTheme);

      function toggleDarkMode() {
        var currentTheme = document.documentElement.getAttribute("data-theme");
        var targetTheme = "light";

        const toggle = document.querySelector("#theme-toggle");
        if (currentTheme === "light") {
          targetTheme = "dark";
        }
        console.debug("toggleDarkMode", targetTheme);
        document.documentElement.setAttribute("data-theme", targetTheme);
        localStorage.setItem("theme", targetTheme);
        toggle.setAttribute(
          "data-content",
          targetTheme === "dark" ? "🌙" : "☀"
        );
      }

      // Set the initial state of the switch toggle
      const toggle = document.querySelector("#theme-toggle");
      if (storedTheme === "dark") {
        toggle.checked = true;
        toggle.setAttribute("data-content", "🌙");
      } else {
        toggle.checked = false;
        toggle.setAttribute("data-content", "☀");
      }
    </script>
  </body>
</html>
